---
title: "NRES 776 Lab 3"
subtitle: "Blank for now"
author: Sunny Tseng
format:
  revealjs: 
    slide-number: true
    preview-links: auto
    #css: styles.css
    #footer: <https://quarto.org>
    theme: [default, styles.scss]
    #smaller: true
    #scrollable: true
    incremental: true
    #embed-resources: true
    width: 1200
    fontsize: 1.7em
editor: visual
---

```{r setup, include = FALSE, cache=FALSE}
#| column: screen
#| out-width: 100%
#| fig-format: svg

set.seed(100)
library(palmerpenguins)
library(tidyverse)
library(here)

knitr::opts_chunk$set(dpi = 150, fig.width = 8, out.width = "90%",
                      fig.align = "center", fig.asp = 0.45)

```

# Welcome to your second R lab!

## Our schedule today

-   Announcements (5 min)

-   Discussion paper presentation (45 mins)

-   Blank for now

-   Quiet time for practice (20 min)

## Announcements

-   Some cool plots we got from lab2
-   Create a R project, and a data folder inside it.
-   Save the spreadsheets inside the data folder.
-   Preset: packages we need today
    -   here: for file path

    -   tidyverse: for data wrangling

    -   readxl: for read in excel files

```{r, echo = TRUE, eval = FALSE}

### Only do this if you haven't install them
install.packages(c("here", "tidyverse", "palmerpenguins"))

### Load the packages
library(here)
library(tidyverse)
library(palmerpenguins)
```

# Discussion paper presentation

-   Abigail Doerksen
-   Julia Bizon
-   Temitope Olufemi

# The universe of tidyverse: background

## Data life cycle

![](images/paste-C6994DE0.png)

-   We have learned data "visualization" and data "import" (sort of) in lab 2

-   Today we want to cover the "tidy" and "transform" part, which all together called "data wrangling"

-   In the world of R, each of this step has some associated packages

## What is tidyverse?

There are some packages that you are likely to use in everyday data analysis:

-   `readr` package: for importing data in R
-   `ggplot2` package: for making graphics, data visualization
-   `dplyr` package: manipulating data frames
-   `purrr` package: working with functions
-   Full list of tidyverse packages is shown here: <https://www.tidyverse.org/packages/>

These are called core tidyverse, and we can load all the tidyverse packages at once by installing and loading the **tidyverse** package:

```{r, echo = TRUE, eval = FALSE}
library(tidyverse)
```

## What's tidyverse?

![](images/paste-9571686D.png){fig-align="center" width="610"}

## Tidy data

> We say that a data table is in *tidy* format if each row represents one observation and columns represent the different variables available for each of these observations.

![](images/paste-02EFA4CE.png){fig-align="center" width="671"}

::: aside
Illustrations from the [Openscapes](https://www.openscapes.org/) blog [Tidy Data for reproducibility, efficiency, and collaboration](https://www.openscapes.org/blog/2020/10/12/tidy-data/) by Julia Lowndes and Allison Horst
:::

## Messy data

> Every messy data set is messy in its own way. - Hadley Wickham

![](images/paste-FBCF203D.png){fig-align="center" width="683"}

::: aside
Illustrations from the [Openscapes](https://www.openscapes.org/) blog [Tidy Data for reproducibility, efficiency, and collaboration](https://www.openscapes.org/blog/2020/10/12/tidy-data/) by Julia Lowndes and Allison Horst
:::

## Common characteristics of messy data

::: columns
::: {.column width="50%"}
-   Commas in numeric values

-   Numeric values stored as character data types

-   Duplicate rows

-   Misspellings

-   Capitalization (e.g., sparrow, Sparrow)

-   Inaccuracies

-   White space

-   Missing data

-   Zeros instead of null values

-   ... and many more
:::

::: {.column width="50%"}
![](images/paste-71148868.png){fig-align="center"}
:::
:::

::: aside
Illustrations from the [Openscapes](https://www.openscapes.org/) blog [Tidy Data for reproducibility, efficiency, and collaboration](https://www.openscapes.org/blog/2020/10/12/tidy-data/) by Julia Lowndes and Allison Horst
:::

## Pipe

> In R we can perform a series of operations by sending the results of one function to another using what is called the *pipe operator*: `%>%` or `|>`

::: columns
::: {.column width="40%"}
-   A thing I will be using through out this lab...

-   Think it like the English word "then".

<!-- -->

-   First, we are dogs

-   Then, drop one ear

-   Then, rotate your head for max cuteness

-   We will get treats!
:::

::: {.column width="60%"}
![](images/paste-0AE74B91.png){fig-align="right" width="626"}
:::
:::

::: aside
Artwork by Allison Horst
:::

## Pipe: %\>% or \|\>

Let's say, we want to find the mean of the petal length column in the iris data set.

::: columns
::: {.column width="50%"}
#### In base R:

```{r, echo = TRUE}

petal_length <- iris$Petal.Length 
petal_length_mean <- mean(petal_length)


petal_length_mean
```

#### You can also do:

```{r, echo = TRUE}
petal_length_mean <- mean(iris$Petal.Length)

petal_length_mean
```
:::

::: {.column width="50%"}
#### In tidyverse, using pipe:

```{r, echo = TRUE}

petal_length_mean <- iris %>%
  pull(Petal.Length) %>%
  mean()

petal_length_mean

```

#### Advantages of using pipe:

-   reduce the number of unnecessary objects
-   easier to read as it has the same logic as speaking
:::
:::

-   In this lab, I am going to use `%>%` for code demonstration, but feel free to use whatever you feel comfortable and efficient.

## Pipe: %\>% or \|\>

-   Pipe is especially powerful when there are multiple operations need to be applied to an object.

### In base R

```{r, echo = TRUE}

iris_sub <- head(iris, n = 50)

iris_sub_sepal_length <- iris_sub$Sepal.Length

iris_sub_sepal_length_mean <- mean(iris_sub_sepal_length, na.rm = TRUE)

iris_sub_sepal_length_mean


```

#### In tidyverse, using pipe:

```{r, echo = TRUE}

iris_sub_sepal_length_mean <- iris %>%
  head(n = 50) %>%
  pull(Sepal.Length) %>%
  mean(na.rm = TRUE)

iris_sub_sepal_length_mean
```

## Base R vs tidyverse?

There is no right or wrong or which way should be used. And both can achieve same tasks. But once you do much more coding, you might find tidyverse coding makes data analysis a bit easier. 😃

::: columns
::: {.column width="50%"}
#### Base R: all the functionality that comes built into the R programming language

-   Use intermediate objects

-   Use `data.frame` data type to manage data frames

-   Use `read.csv()` to import files

-   Use `[ , col]` or `$` to isolate column

-   ... and more
:::

::: {.column width="50%"}
#### Tidyverse: a collection of packages that add onto R, with its own focus on data analysis.

-   Use pipes

<!-- -->

-   Use `tibble` data type to manage data frames

-   Use `read_csv()` to import files

-   Use `pull()` function to isolate column

-   ... and more
:::
:::

# Data I/O: with csv files

with tidyverse `readr` package

# Data wrangling: rows

with tidyverse `dplyr` package

## Tidyverse dplyr functions

### For managing rows

-   list of the functions we are going to learn

-   we are using penguins data set (again!) 🐧

## filter()

> Keep rows that match condition(s). Input a tibble, return a filtered tibble.

### Keep rows where bill length value larger than 18

```{r, echo = TRUE}
penguins %>% 
  filter(bill_depth_mm > 18)
```

## filter()

### Keep rows that is NOT measured from Torgersen island

```{r, echo = TRUE}
penguins %>% 
  filter(island != "Torgersen")
```

## filter()

### Multiple conditions

```{r, echo = TRUE}
penguins %>% 
  filter(species == "Chinstrap" & island == "Dream")
```

## filter()

### Remove rows with missing values

This doesn't work, because `NA` is not comparable

```{r, echo = TRUE, eval = FALSE}
penguins %>%
  filter(bill_depth_mm != NA)
```

Do this, using `is.na()` function

```{r, echo = TRUE, eval = FALSE}
penguins %>%
  filter(!is.na(bill_depth_mm))
```

Or this, using `drop_na()` function

```{r, echo = TRUE, eval = FALSE}
penguins %>%
  drop_na(bill_depth_mm)
```

## filter()

### Keep rows that contain elements of interest

```{r, echo = TRUE}

species_vector <- c("King", "Emperor", "Snares", "Chinstrap")

penguins %>%
  filter(species %in% species_vector)

```

## arrange()

## distinct()

# Data wrangling: columns

with tidyverse `dplyr` package

## Tidyverse dplyr functions

### For managing columns

-   list of the functions we are going to learn

## mutate()

-   one single value

-   row ID row_number()

-   `as_numeric()`, `as_factor()`

-   calculation of another column

-   `if_else()`

-   `case_when()`

-   `pmax()` and `pmin()` (different from `max()` and `min()`)

-   `cut()`

## select()

## rename()

## relocate()

# Data wrangling: group calculation

## group_by()

## summarize()

-   `count(sort = TRUE)`, the same as

-   `n()`: count the number of observations in the group

-   `n_distinct()`

-   `sum()`

## slice\_\*() functions

## ungroup()

# Data wrangling: reshape

with tidyverse `dplyr` package

## pivot_longer()

## pivot_wider()

# Data wrangling: combining two tibbles

# Data wrangling: other useful functions

## clean_names()

# Data I/O: Self-contained projects

We will be using `here` package and R project

## Concept of a project

> If the first line of your R script is `setwd("C:\Users\jenny\path\that\only\I\have")` I will come into your office and SET YOUR COMPUTER ON FIRE 🔥. - Jenny Bryan

-   Have you ever received a R script from a friend with this line

-   And it's 0% chance that you can run this `setwd()` without an error

-   If you never heard about `setwd()`

-   Don't worry, you don't need to know 😄

![](images/paste-58AC1017.png){.absolute top="300" right="0" width="622"}

## Concept of a project

> A folder on your computer that holds all the files relevant to that particular piece of work.

-   Get your files organized

-   Your work is reproducible

-   There are two things that can help us creating a self-contained project

### 1. R project

A self-contained working environment with folders for data, scripts, outputs, etc

### 2. `here` package

When import/export data is required, filepaths are written relative to the root folder of the R project.

## R project: how to use

1.  Open R Studio
2.  Select `File` \> `New Project` \> `New Directory` \> provide name and where you want it to be saved
3.  The R project you create will come in as a folder containing a *.Rproj* file
4.  This is a shortcut and likely the primary way you will open your project
5.  Your R Studio top-right corner would show the project you are in

![](images/paste-2092CCC6.png){fig-align="center"}

## `here` package: how to use

1.  It's a good practice to structure your working directory in a consistent way
2.  Created a data sub folder, and put all the data files you might need
3.  Store your R script in the root
4.  Run `library(here)` as the first line in script
5.  Then you will only need relative path whenever you need to import data

```{r, eval = FALSE, echo = TRUE}
library(here)
my_data <- read_csv(here("data", "my_data.csv"))

```

![](images/57457fc3-1d2d-4a3b-a9b7-f0b62e418cd5.png){fig-align="center" width="419"}

![](images/Capture-02.PNG){.absolute bottom="300" right="0" width="261"}

# Data I/O: Read and write spreadsheet data in R

We will be using packages `readr` and `readxl`

Practice files were posted on Moodle, download and save them to your data folder

## Overview

```{r, echo = TRUE}
library(readr)
library(readxl)
```

With `readr` and `readxl`, you will be able to use the following functions to read spreadsheets into R.

| Function       | Format                                            | Typical suffix |
|-------------------|----------------------------------|-------------------|
| `read_delim()` | general text file format, must define delimiter   | .txt           |
| `read_csv()`   | comma separated values                            | .csv           |
| `read_csv2()`  | semicolon separated values                        | .csv           |
| `read_tsv()`   | tab delimited separated values                    | .tsv           |
| `read_table()` | white space separated values                      | .txt           |
| `read_excel()` | auto detect the format for Microsoft excel sheets | .xlsx or .xls  |

::: aside
Note: `readr` is one of the `tidyverse` core packages, so you don't need to load it separately if you already have `tidyverse`
:::

## Read CSVs

> `read_csv()` take one necessary argument, which is `file`, a path to a file.

```{r, echo = TRUE}

my_csv_data <- read_csv(file = here("data", "rock.csv"))

my_csv_data
```

## Read excel files

> `read_excel()` take one necessary argument, which is `path`, a path to a file. You will need to define `sheet` argument if you have more than one sheet in excel (default to first sheet).

```{r, echo = TRUE}
my_excel_data <- read_excel(path = here("data", "rock.xlsx"),
                            sheet = 1)

my_excel_data
```

## Read TSVs or TXTs

> `read_tsv()` take one necessary argument, which is `file`, a path to a file.

```{r, echo = TRUE}
my_tsv_data <- read_tsv(file = here("data", "rock.tsv"))

my_tsv_data
```

## Read whatever

> `read_delim()` take two necessary argument, which is `file`, a path to a file, and `delim`, the separator. It's the most flexible way to read in data.

```{r, echo = TRUE}
my_data <- read_delim(file = here("data", "rock.txt"),
                      delim = "\t")

my_data
```

## Write CSVs

### csv is the most commonly used because of its simplicity and compatibility

> `write_csv()` takes two necessary arguments `x`, the data frame object you want to export, and `file`, the path you want to save the file to.

```{r, echo = TRUE}

write_csv(x = my_data,
          file = here("data", "my_data.csv"))
```

Now, check your folder, and you should find a file got saved with the name `my_data.csv`.

![](images/paste-14D85C4A.png){fig-align="center"}

# 

# R Others: Miscellaneous

Here is some advanced materials if you are comfortable and familiar with the content above

## What's wrong?

-   no installation of package

-   no bracket

-   wrong kind of bracket

-   ggplot2 package but the function is ggplot haha

-   no geom\_() specified

-   the theme is not working because of the sequence

-   fill and colour in bar plot!

## R `ggplot()` cheatsheet

## Commenting your code

## Short cuts

-   Ctrl + Enter

-   Ctrl +Shift + C

-   Ctrl + I

-   Ctrl + L

-   Esc

-   Ctrl + S

# Lab assignment

## Your task

We are going to work on the `penguins_raw` data set from the `palmarpenguins` package. Your task is to **wrangle** the `penguins_raw` and make it look like our target data set, which I provided as a *.csv* file on Moodle.

-   Download the *NRES776_target_lab3.csv* from Moodle.

-   Here are some lines might be helpful for you to get started.

-   The goal is to get the `all_equal()` to return `TRUE`!

```{r, echo = TRUE, eval = FALSE}

### Library, add any libraries you might need
library(tidyverse)
library(here)
library(palmerpenguins)

### Read in the target data set, or however your prefer to import data
target <- read_csv("data/NRES776_target_lab3.csv")

### Your code here
my_clean_dataset <- penguins_raw %>%
  ...

### Final check
all_equal(my_clean_dataset, target)
```

## Your task

### Hints

## Submission

### Due next Wednesday 23:59 pm, Moodle

### Evaluation

-   File name and type (NRES776\_*firstname*\_*lastname*\_lab_2.**png**) (10%)

-   Accuracy, 15%, and quality, 25%, of each two plots -\> (80%)

-   Annotation of the final patchwork product (10%)

-   Bonus points for extra question (30%)

### Use of ChatGPT, stackflow, or...

-   Copy/Paste is your friend! (and never apologize for it!) 😍

-   But be sure you understand **why** the codes are doing what they are doing 🧑‍🎓

-   So that you form some new neuron connections in the brain 🧠

## Quiet/Noisy room

![](images/d6b4f8cb-53bf-49d5-822c-e45cd01204a4.png){fig-align="center" width="867"}

::: footer
Artwork by @allison_horst
:::

## Wrap up

### Before we meet again

-   Have a nice food intake

-   Have a nap

-   Have a good break

### Next time

-   Will see you in 1.5 hours on zoom!
